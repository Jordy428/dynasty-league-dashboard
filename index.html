<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynasty League Dashboard</title>
  <style>
    body { font‑family: Arial, sans‑serif; margin: 20px; }
    h1, h2 { color: #333; }
    .section { margin‑bottom: 40px; }
    table { border‑collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text‑align: left; }
    th { background: #f4f4f4; }
  </style>
</head>
<body>

  <h1>Your Dynasty League Dashboard</h1>

  <div class="section" id="leagueInfo">
    <h2>League Info</h2>
    <div id="leagueDetails">Loading…</div>
  </div>

  <div class="section" id="standings">
    <h2>Standings</h2>
    <div id="standingsTable">Loading…</div>
  </div>

  <div class="section" id="rosters">
    <h2>Rosters</h2>
    <div id="rostersTable">Loading…</div>
  </div>

  <div class="section" id="transactions">
    <h2>Transactions / Trades</h2>
    <div id="transactionsTable">Loading…</div>
  </div>

  <script>
    const leagueId = "1181314304454733824"; // replace with your league ID if needed
    const baseUrl = "https://api.sleeper.app/v1";

    async function fetchJson(url) {
      const resp = await fetch(url);
      if (!resp.ok) throw new Error("Network response was not ok");
      return await resp.json();
    }

    async function loadLeagueInfo() {
      const data = await fetchJson(`${baseUrl}/league/${leagueId}`);
      document.getElementById("leagueDetails").innerHTML =
        `<strong>Name:</strong> ${data.name} <br>` +
        `<strong>Season:</strong> ${data.season} <br>` +
        `<strong>Status:</strong> ${data.status}`;
    }

    async function loadRostersAndUsers() {
      const [rosters, users] = await Promise.all([
        fetchJson(`${baseUrl}/league/${leagueId}/rosters`),
        fetchJson(`${baseUrl}/league/${leagueId}/users`)
      ]);
      // build map user_id→display_name
      const userMap = {};
      users.forEach(u => userMap[u.user_id] = u.display_name || u.username);
      let html = "<table><tr><th>Team (Owner)</th><th>Players</th></tr>";
      rosters.forEach(r => {
        const owner = userMap[r.owner_id] || r.owner_id;
        const players = r.players.join(", ");
        html += `<tr><td>${owner}</td><td>${players}</td></tr>`;
      });
      html += "</table>";
      document.getElementById("rostersTable").innerHTML = html;
    }

    async function loadStandings() {
      const rosters = await fetchJson(`${baseUrl}/league/${leagueId}/rosters`);
      const users = await fetchJson(`${baseUrl}/league/${leagueId}/users`);
      const userMap = {};
      users.forEach(u => userMap[u.roster_id] = u.display_name || u.username);
      // Sorting by wins might require more processing depending on API
      let html = "<table><tr><th>Team (Owner)</th><th>Wins</th><th>Losses</th><th>Points For</th></tr>";
      rosters.sort((a,b) => b.settings.wins - a.settings.wins)
             .forEach(r => {
                const owner = userMap[r.roster_id] || r.roster_id;
                html += `<tr><td>${owner}</td><td>${r.settings.wins}</td><td>${r.settings.losses}</td><td>${r.settings.points_for.toFixed(2)}</td></tr>`;
             });
      html += "</table>";
      document.getElementById("standingsTable").innerHTML = html;
    }

    async function loadTransactions() {
  let html = "<table><tr><th>Week</th><th>Type</th><th>Date</th><th>Details</th></tr>";
  for (let week = 1; week <= 18; week++) {
    try {
      const data = await fetchJson(`${baseUrl}/league/${leagueId}/transactions/${week}`);
      data.forEach(t => {
        const date = new Date(t.created * 1000).toLocaleString();
        html += `<tr><td>${week}</td><td>${t.type}</td><td>${date}</td><td>${JSON.stringify(t)}</td></tr>`;
      });
    } catch (e) {
      console.log(`No data for week ${week}`);
    }
  }
  html += "</table>";
  document.getElementById("transactionsTable").innerHTML = html;
}


    async function init() {
      try {
        await loadLeagueInfo();
        await loadStandings();
        await loadRostersAndUsers();
        await loadTransactions();
      } catch (err) {
        console.error(err);
        alert("Error loading data — check console");
      }
    }

    init();
  </script>

</body>
</html>
